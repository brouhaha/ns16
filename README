ns16: Assembler and Simulator for National Semiconductor IMP-16 and PACE

Copyright 2009, 2015 Eric Smith <spacewar@gmail.com>
All rights reserved.

ns16 provides a crude assembler and simulator for the National
Semiconductor IMP-16 multichip processor, and PACE, which was the
first monolithic 16-bit microprocessor.

ns16 is supplied with a copy of FIG-Forth for the PACE.  The
original code (plus any typographical errors I may have introduced)
is in the file figforth_pace.orig.asm.  This file is in the public
domain.

A version of FIG-Forth with a bug in USLASH fixed and minor changes to
suit the simulator is in the file figforth_pace.fixed.asm.

A version of FIG-Forth with added support for simulated disk block I/O
is in the file figforth_pace.asm.

Currently the aim is to assemble and simulate PACE code just well
enough to run FIG-Forth.  The assembler only recognizes the minimum
set of pseudo-ops necessary to assemble FIG-Forth, and some of them
are ignored.  The simulator does not implement all of the PACE
instructions; in particular, the DECA (decimal add) instruction is not
implemented.  Interrupts are not implemented.  None of the
instructions are well tested, so there are likely to be lurking bugs.

The assembler and simulator are written in C, LEX, and YACC.  SCons is
used as a build system rather than make.  The tools used for
development are GCC 4.8.3, Flex 2.5.37, GNU Bison 2.7, Python 2.7.5,
and SCons 2.3.0.  Other versions of the tools may work but have not been
tested.

Like the National Semiconductor assembler, pasm will automatically
generate indirect words for out-of-range jumps and subroutine calls.
However, the order of these indirect words may be different than those
generated by the National Semiconductor assembler.

To compile ns16, you will need Python and SCons.  SCons is an
alternative to make and is available from:

	http://www.scons.org/

To compile n16, simply type:

	scons

This will build pasm and psim, and assemble FIG-Forth.

To assemble a file foo.asm, type:

	pasm -o foo.obj -l foo.lst foo.asm

Note that on Linux or Unix systems, the current directory will not
be in the execution path, so you will need to give the command
as

	./pasm -o foo.obj -l foo.lst foo.asm

The only I/O currently simulated is a serial console, via the host
system standard input and output.  The simulator special-cases code
execution at addresses 7E3B, 7E44, 7ECC, and 7EFF for the input character,
output character, test input ready, and disk I/O functions.  (The
first three addresses were chosen simply because the original PACE
FIG-Forth as supplied used them.)

To execute the simulator on most operating systems, type:

	psim

Note that on Linux or Unix systems, the current directory will not
be in the execution path, so you will need to give the command
as

	./psim

The simulator will load and execute the Pace object file
"figforth_pace.obj".

I'm no FORTH expert, but here are a few trivial things you can type
in to see that it works:

	1 2 + .

Should add one and two, and print the result 3.

       : FOO 27 * 5 + ;

Defines a word FOO that takes the number on the top of the stack,
multiplies it by 27, and adds 5.

	-3 FOO .

Should print -76.

	: OE 1 AND IF ." ODD" ELSE ." EVEN" ENDIF ;

Defines a word OE that prints ODD or EVEN depending on the number
on the top of the stack.

	4 OE

will print "EVEN", while

	5 OE

will print "ODD".
